// Generated by CoffeeScript 1.3.3
(function() {

  define(["libs/backbone", "libs/underscore"], function() {
    var LayoutView;
    LayoutView = Backbone.View.extend({
      initialize: function() {
        _.bindAll(this);
        this.$el = $(this.el);
        this.total = 0;
        this.model = new Backbone.Model(JSON.parse(this.$('.data').html()));
        this.model.set('images', _.shuffle(this.model.get('images')));
        _.each(this.model.get('images'), this.addCell);
        this.makeGrid();
      },
      template: _.template("<div class=\"cell\">\n	<div class=\"image\" style=\"background-image: url('/assets/img/lookwork/<%= arguments[0] %>');\">\n\n	</div>\n</div>"),
      addCell: function(img) {
        var cell, height, span, width;
        cell = $(this.template(img));
        span = Math.ceil(Math.random() * 3);
        this.columnWidth = 130;
        this.marginWidth = 20;
        width = ((this.columnWidth + this.marginWidth) * span) - this.marginWidth;
        height = width * 0.67;
        if (Math.random() < 0.3) {
          height = width * 1.5;
        } else if (Math.random() < 0.6) {
          height = width;
        }
        if (width === 130) {
          height = 130;
        }
        height = width;
        cell.css({
          width: "" + width + "px",
          height: "" + height + "px"
        });
        if (Math.random() < 0.333333) {
          cell.addClass('left');
        } else if (Math.random() < 0.66666) {
          cell.addClass('center');
        } else {
          cell.addClass('right');
        }
        if (Math.random() < 0.5) {
          cell.addClass('bottom');
        }
        this.$el.append(cell);
      },
      makeGrid: function() {
        $('#grid').isotope({
          masonry: {
            columnWidth: this.columnWidth + this.marginWidth
          }
        });
      }
    });
    return LayoutView;
  });

}).call(this);
